// /*----- constants -----*/

let deck = [
  {
    value: 2,
    image: "card-deck/images/clubs/clubs-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/diamonds/diamonds-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/hearts/hearts-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/spades/spades-r02.svg"
  },
  {
    value: 3,
    image: "card-deck/images/clubs/clubs-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/diamonds/diamonds-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/hearts/hearts-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/spades/spades-r03.svg"
  },
  {
    value: 4,
    image: "card-deck/images/clubs/clubs-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/diamonds/diamonds-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/hearts/hearts-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/spades/spades-r04.svg"
  },
  {
    value: 5,
    image: "card-deck/images/clubs/clubs-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/diamonds/diamonds-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/hearts/hearts-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/spades/spades-r05.svg"
  },
  {
    value: 6,
    image: "card-deck/images/clubs/clubs-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/diamonds/diamonds-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/hearts/hearts-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/spades/spades-r06.svg"
  },
  {
    value: 7,
    image: "card-deck/images/clubs/clubs-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/diamonds/diamonds-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/hearts/hearts-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/spades/spades-r07.svg"
  },
  {
    value: 8,
    image: "card-deck/images/clubs/clubs-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/diamonds/diamonds-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/hearts/hearts-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/spades/spades-r08.svg"
  },
  {
    value: 9,
    image: "card-deck/images/clubs/clubs-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/diamonds/diamonds-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/hearts/hearts-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/spades/spades-r09.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-K.svg"
  },
  {
    value: 11,
    image: "card-deck/images/clubs/clubs-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/diamonds/diamonds-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/hearts/hearts-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/spades/spades-A.svg"
  }
];
const deck1 = [
  {
    value: 2,
    image: "card-deck/images/clubs/clubs-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/diamonds/diamonds-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/hearts/hearts-r02.svg"
  },
  {
    value: 2,
    image: "card-deck/images/spades/spades-r02.svg"
  },
  {
    value: 3,
    image: "card-deck/images/clubs/clubs-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/diamonds/diamonds-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/hearts/hearts-r03.svg"
  },
  {
    value: 3,
    image: "card-deck/images/spades/spades-r03.svg"
  },
  {
    value: 4,
    image: "card-deck/images/clubs/clubs-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/diamonds/diamonds-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/hearts/hearts-r04.svg"
  },
  {
    value: 4,
    image: "card-deck/images/spades/spades-r04.svg"
  },
  {
    value: 5,
    image: "card-deck/images/clubs/clubs-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/diamonds/diamonds-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/hearts/hearts-r05.svg"
  },
  {
    value: 5,
    image: "card-deck/images/spades/spades-r05.svg"
  },
  {
    value: 6,
    image: "card-deck/images/clubs/clubs-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/diamonds/diamonds-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/hearts/hearts-r06.svg"
  },
  {
    value: 6,
    image: "card-deck/images/spades/spades-r06.svg"
  },
  {
    value: 7,
    image: "card-deck/images/clubs/clubs-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/diamonds/diamonds-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/hearts/hearts-r07.svg"
  },
  {
    value: 7,
    image: "card-deck/images/spades/spades-r07.svg"
  },
  {
    value: 8,
    image: "card-deck/images/clubs/clubs-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/diamonds/diamonds-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/hearts/hearts-r08.svg"
  },
  {
    value: 8,
    image: "card-deck/images/spades/spades-r08.svg"
  },
  {
    value: 9,
    image: "card-deck/images/clubs/clubs-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/diamonds/diamonds-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/hearts/hearts-r09.svg"
  },
  {
    value: 9,
    image: "card-deck/images/spades/spades-r09.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-r10.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-J.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-Q.svg"
  },
  {
    value: 10,
    image: "card-deck/images/clubs/clubs-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/diamonds/diamonds-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/hearts/hearts-K.svg"
  },
  {
    value: 10,
    image: "card-deck/images/spades/spades-K.svg"
  },
  {
    value: 11,
    image: "card-deck/images/clubs/clubs-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/diamonds/diamonds-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/hearts/hearts-A.svg"
  },
  {
    value: 11,
    image: "card-deck/images/spades/spades-A.svg"
  }
];
const cardBack = "card-deck/images/backs/blue.svg";

// /*----- app's state (variables) -----*/

let p1CB = 0;
let p2CB = 0;
let p1W = 100;
let p2W = 100;
let dealerTotal = null;
const player1Cards = {
  value: [],
  image: []
};
const player2Cards = {
  value: [],
  image: []
};
const dealerHand = {
  value: [],
  image: []
};
let p1Total = 0;
let p2Total = 0;
let isPlayer1NotBusted = true;
let isPlayer2NotBusted = true;
let isPlayer1NotStay = true;
let isPlayer2NotStay = true;
let isDealerStay = true;
let isPlayer1NotBlackjack = true;
let isPlayer2NotBlackjack = true;
let player1DDActive = false;
let player2DDActive = false;
let isDealerBusted = false;
// /*----- cached DOM element references -----*/

let dealerCards = document.getElementById("dc");
let dcard1 = document.getElementById("dcard1");
let dcard2 = document.getElementById("dcard2");
let dTotal = document.getElementById("dealer-tot");
let p2Cards = document.getElementById("p2cards");
let p2Card1 = document.getElementById("p2card1");
let p2Card2 = document.getElementById("p2card2");
let p2Wallet = document.getElementById("w2");
let p2Bet = document.getElementById("cb2");
let p1Cards = document.getElementById("p1cards");
let p1Card1 = document.getElementById("p1card1");
let p1Card2 = document.getElementById("p1card2");
let p1Wallet = document.getElementById("w1");
let p1Bet = document.getElementById("cb1");
let stay1 = document.getElementById("stay1");
let DD1 = document.getElementById("DD1");
let hit1 = document.getElementById("hit1");
let bet1 = document.getElementById("bet1");
let ins1 = document.getElementById("ins1");
let play1 = document.getElementById("play1");
let stay2 = document.getElementById("stay2");
let DD2 = document.getElementById("DD2");
let hit2 = document.getElementById("hit2");
let bet2 = document.getElementById("bet2");
let ins2 = document.getElementById("ins2");
let play2 = document.getElementById("play2");
let player1Total = document.getElementById("p1total");
let player2Total = document.getElementById("p2total");
let p1Mes = document.getElementById("p1message");
let p2Mes = document.getElementById("p2message");

// /*----- event listeners -----*/

// p1 buttons
document.getElementById("stay1").addEventListener("click", player1Stay);
document.getElementById("DD1").addEventListener("click", player1DD);
document.getElementById("hit1").addEventListener("click", player1Hit);
document.getElementById("bet1").addEventListener("click", betP1);
// document.getElementById("ins1").addEventListener("click", insurance);
document.getElementById("play1").addEventListener("click", player1Play);

// // p2 buttons
document.getElementById("stay2").addEventListener("click", player2Stay);
document.getElementById("DD2").addEventListener("click", player2DD);
document.getElementById("hit2").addEventListener("click", player2Hit);
document.getElementById("bet2").addEventListener("click", betP2);
// document.getElementById("ins2").addEventListener("click");
document.getElementById("play2").addEventListener("click", player2Play);

// /*----- functions -----*/

init();

function init() {
  deck = deck1.map(x => x);
  bet1.disabled = false;
  play1.disabled = true;
  DD1.disabled = true;
  ins1.disabled = true;
  hit1.disabled = true;
  stay1.disabled = true;
  bet2.disabled = false;
  play2.disabled = true;
  DD2.disabled = true;
  ins2.disabled = true;
  hit2.disabled = true;
  stay2.disabled = true;
  p1Bet.innerText = 0;
  p1Wallet.innerText = 100;
  p2Bet.innerText = 0;
  p2Wallet.innerText = 100;
  p1Total = 0;
  p2Total = 0;
}

function player1AceOr1() {
  if (player1Cards.value.reduce((a, b) => a + b, 0) > 21) {
    let hold = player1Cards.value.indexOf(11);
    player1Cards.value[hold] = 1;
  }
}

function player2AceOr1() {
  if (player2Cards.value.reduce((a, b) => a + b, 0) > 21) {
    let hold = player2Cards.value.indexOf(11);
    player2Cards.value[hold] = 1;
  }
}

function dealerAceOr1() {
  if (dealerHand.value.reduce((a, b) => a + b, 0) > 21) {
    let hold = dealerHand.value.indexOf(11);
    dealerHand.value[hold] = 1;
  }
}

function hitD() {
  console.log("dealer hits");
  dealerHand.value.push(deck[0].value);
  dealerHand.image.push(deck[0].image);
  dcard1.src = dealerHand.image[dealerHand.image.length - 1];
  deck.shift();
  dealerAceOr1();
  dealerPlay();
}

function player1Hit() {
  DD1.disabled = true;
  player1Cards.value.push(deck[0].value);
  player1Cards.image.push(deck[0].image);
  p1Card1.src = player1Cards.image[player1Cards.image.length - 1];
  deck.shift();
  player1AceOr1();
  render();
}

function player2Hit() {
  DD2.disabled = true;
  ``;
  player2Cards.value.push(deck[0].value);
  player2Cards.image.push(deck[0].image);
  p2Card1.src = player2Cards.image[player2Cards.image.length - 1];
  deck.shift();
  player2AceOr1();
  render();
}

function deal() {
  player1Cards.value.push(deck[0].value);
  player1Cards.image.push(deck[0].image);
  p1Card1.src = player1Cards.image[0];
  deck.shift();
  if (p2CB === 0) {
    p2Mes.innerText = "Too late. Join next time";
  }
  if (p2CB > 0) {
    player2Cards.value.push(deck[0].value);
    player2Cards.image.push(deck[0].image);
    p2Card1.src = player2Cards.image[0];
    deck.shift();
  }
  dealerHand.value.push(deck[0].value);
  dealerHand.image.push(deck[0].image);
  dcard1.src = dealerHand.image[0];
  deck.shift();
  player1Cards.value.push(deck[0].value);
  player1Cards.image.push(deck[0].image);
  p1Card2.src = player1Cards.image[1];
  deck.shift();
  if (p2CB > 0) {
    player2Cards.value.push(deck[0].value);
    player2Cards.image.push(deck[0].image);
    p2Card2.src = player2Cards.image[1];
    deck.shift();
  }
  dealerHand.value.push(deck[0].value);
  dealerHand.image.push(deck[0].image);
  deck.shift();
}

function shuffle() {
  deck = deck.sort(() => Math.random() - 0.5);
  deal();
}

function betP1() {
  if (p1W === 0) {
    bet1.disabled = true;
    return;
  }
  p1Mes.innerText = "";
  p1CB += 5;
  p1W -= 5;
  p1Bet.innerText = p1CB;
  p1Wallet.innerText = p1W;
  if (p1CB > 0) {
    play1.disabled = false;
  }
}

function betP2() {
  if (p2W === 0) {
    bet2.disabled = true;
  }
  return;
  p2Mes.innerText = "";
  p2CB += 5;
  p2W -= 5;
  p2Bet.innerText = p2CB;
  p2Wallet.innerText = p2W;
}

function dealerPlay() {
  dcard2.src = dealerHand.image[1];
  dealerTotal = dealerHand.value.reduce((a, b) => a + b, 0);
  if (dealerTotal > 21) {
    console.log("dealer bust");
    isDealerBusted = true;
  }
  if (dealerTotal < 17) {
    setTimeout(hitD, 2000);
  } else if (isDealerStay) {
    dealerStay();
  }
  render();
}

function player1Play() {
  bet1.disabled = true;
  play1.disabled = true;
  DD1.disabled = false;
  ins1.disabled = false;
  hit1.disabled = false;
  stay1.disabled = false;
  bet2.disabled = true;
  shuffle();
  render();
  player1Blackjack();
}

function player2Play() {
  if (p1Total > 0) {
    bet2.disabled = true;
    play2.disabled = true;
    DD2.disabled = false;
    ins2.disabled = false;
    hit2.disabled = false;
    stay2.disabled = false;
    player2Blackjack();
    render();
  }
}

// function insurance() {}
// insurance
//     pop insurance button
//     if dealer has blackjack
//     match bet amount and reduce wallet
//     call payout insurance
//     render

function player1DD() {
  player1DDActive = true;
  p1W -= p1CB;
  p1Wallet.innerText = p1W;
  p1CB *= 2;
  p1Bet.innerText = p1CB;
  player1Hit();
  player1Stay();
}
function player2DD() {
  player2DDActive = true;
  p2W -= p2CB;
  p2Wallet.innerText = p2W;
  p2CB *= 2;
  p2Bet.innerText = p2CB;
  player2Hit();
  player2Stay();
}

function dealerStay() {
  console.log("dealer stays");
  console.log(dealerHand);
  isDealerStay = false;
  checkWin();
  setTimeout(refresh, 4000);
}

function player1Stay() {
  isPlayer1NotStay = false;
  if (p2CB > 0) {
    play2.disabled = false;
  } else {
    dealerPlay();
  }
  bet1.disabled = true;
  DD1.disabled = true;
  ins1.disabled = true;
  hit1.disabled = true;
  stay1.disabled = true;
}

function player2Stay() {
  isPlayer2NotStay = false;
  bet2.disabled = true;
  DD2.disabled = true;
  ins2.disabled = true;
  hit2.disabled = true;
  stay2.disabled = true;
  dealerPlay();
}

function player1Blackjack() {
  if (
    p1Total === 21 &&
    dealerTotal !== 21 &&
    player1Cards.value.length === 2 &&
    isPlayer1NotBlackjack
  ) {
    isPlayer1NotBlackjack = false;
    p1W += Math.ceil(p1CB * 2.5);
    p1Mes.innerText = `Player 1 Got Blackjack!`;
    p1Wallet.innerText = p1W;
    p1Bet.innerText = 0;
  }
}

function player2Blackjack() {
  if (
    p2Total === 21 &&
    dealerTotal !== 21 &&
    player2Cards.value.length === 2 &&
    isPlayer2NotBlackjack
  ) {
    isPlayer2NotBlackjack = false;
    p2W += Math.ceil(p2CB * 2.5);
    p2Mes.innerText = `Player 2 Got Blackjack!`;
    p2Wallet.innerText = p2W;
    p2Bet.innerText = 0;
  }
}

// payout insurance
//     calculate appropriate amount
//     add amount to wallet
//     change game active to no
//     render

function checkWin() {
  if (
    (p1Total < 22 &&
      p1Total > dealerTotal &&
      isPlayer1NotBusted &&
      isPlayer1NotBlackjack) ||
    (isPlayer1NotBusted && isPlayer1NotBlackjack && isDealerBusted)
  ) {
    p1CB *= 2;
    p1W += p1CB;
    p1Wallet.innerText = p1W;
    p1Mes.innerText = `Player 1 Won ${p1CB}`;
  }
  if (
    (p2Total < 22 &&
      p2Total > dealerTotal &&
      isPlayer2NotBusted &&
      isPlayer2NotBlackjack) ||
    (isPlayer2NotBusted && isPlayer2NotBlackjack && isDealerBusted)
  ) {
    p2CB *= 2;
    p2W += p2CB;
    p2Wallet.innerText = p2W;
    p2Mes.innerText = `Player 2 Won ${p2CB}`;
  }
  if (p1Total === dealerTotal && p1Total < 22) {
    p1W += p1CB;
    p1Wallet.innerText = p1W;
    p1Mes.innerText = `Player 1 Tied`;
  }
  if (p2Total === dealerTotal && p2Total < 22) {
    p2W += p2CB;
    p2Wallet.innerText = p2W;
    p2Mes.innerText = `Player 2 Tied`;
  }
  if (p1Total < dealerTotal && dealerTotal < 22) {
    p1Mes.innerText = `Player 1 Lost`;
  }
  if (p2Total < dealerTotal && dealerTotal < 22) {
    p2Mes.innerText = `Player 2 Lost`;
  }
}

function player1Lose() {
  bet1.disabled = true;
  DD1.disabled = true;
  ins1.disabled = true;
  hit1.disabled = true;
  stay1.disabled = true;
  isPlayer1NotBusted = false;
}
function player2Lose() {
  bet2.disabled = true;
  DD2.disabled = true;
  ins2.disabled = true;
  hit2.disabled = true;
  stay2.disabled = true;
  isPlayer2NotBusted = false;
}

function render() {
  p1Total = player1Cards.value.reduce((a, b) => a + b, 0);
  player1Total.innerText = p1Total;
  p2Total = player2Cards.value.reduce((a, b) => a + b, 0);
  player2Total.innerText = p2Total;
  dTotal.innerText = dealerTotal;

  if (p1Total > 21 && isPlayer1NotBusted) {
    p1Mes.innerText = `Player 1 Busted`;
    player1Lose();
    player1Stay();
  }
  if (p1Total === 21 && isPlayer1NotStay) {
    player1Stay();
  }
  if (p2Total > 21 && isPlayer2NotBusted) {
    p2Mes.innerText = `Player 2 Busted`;
    player2Lose();
    player2Stay();
  }
  if (p2Total === 21 && isPlayer2NotStay) {
    player2Stay();
  }
}

function refresh() {
  isPlayer1NotBlackjack = true;
  isPlayer1NotBusted = true;
  isPlayer1NotStay = true;
  isPlayer2NotBlackjack = true;
  isPlayer2NotBusted = true;
  isPlayer2NotStay = true;
  isDealerStay = true;
  isDealerBusted = false;
  deck = deck1.map(x => x);
  bet1.disabled = false;
  bet2.disabled = false;
  p1CB = 0;
  p1Bet.innerText = p1CB;
  p2CB = 0;
  p2Bet.innerText = p2CB;
  p1Mes.innerText = "Click bet to start";
  p2Mes.innerText = "Click bet to join the game";
  setTimeout(resetCards, 1000);
}

function resetCards() {
  p1Card1.src = cardBack;
  p1Card2.src = cardBack;
  p2Card1.src = cardBack;
  p2Card2.src = cardBack;
  dcard1.src = cardBack;
  dcard2.src = cardBack;
  player1Cards.value = [];
  player1Cards.image = [];
  player2Cards.value = [];
  player2Cards.image = [];
  dealerHand.value = [];
  dealerHand.image = [];
}
